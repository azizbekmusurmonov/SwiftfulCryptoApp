//
//  MarketDataModel.swift
//  SwiftfulCrypto
//
//  Created by Azizbek Musurmonov   on 30/03/24.
//

import Foundation

// JSON data:
/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response
 {"data":{"active_cryptocurrencies":13561,"upcoming_icos":0,"ongoing_icos":49,"ended_icos":3376,"markets":1031,"total_market_cap":{"btc":39653853.024848305,"eth":789700020.3133769,"ltc":25989705233.455173,"bch":4590496718.9532385,"bnb":4516626335.296857,"eos":2527281047924.464,"xrp":4408722448409.686,"xlm":19427279132320.51,"link":146343740460.96878,"dot":289931132405.66815,"yfi":306974276.5215545,"usd":2754493461516.4785,"aed":10116979034803.889,"ars":2.360788741955726e+15,"aud":4223833926667.063,"bdt":302298487454953.25,"bhd":1038457807459.022,"bmd":2754493461516.4785,"brl":13814335608197.432,"cad":3731363549669.451,"chf":2484051784477.8696,"clp":2698714968920771.5,"cny":19890748184302.79,"czk":64426503021979.28,"dkk":19037306948160.363,"eur":2552016156147.3267,"gbp":2182467804363.351,"gel":7437132346094.498,"hkd":21554902954012.6,"huf":1004708982310351.2,"idr":4.3725832168762824e+16,"ils":10165017400772.738,"inr":229551497051745.16,"jpy":416915497910664.5,"krw":3.708220003629484e+15,"kwd":848585064169.7681,"lkr":827566086481601.5,"mmk":5.784221385640688e+15,"mxn":45648291992289.57,"myr":13013604358934.592,"ngn":3.843785445807788e+15,"nok":29849123485592.57,"nzd":4605022767819.409,"php":154706117002592.53,"pkr":765593187073376.1,"pln":10950626480931.824,"rub":255045692003356.72,"sar":10340032406330.566,"sek":29413224895307.57,"sgd":3714764972070.3535,"thb":100125837326124.05,"try":89303435270319.22,"twd":88061150455694.83,"uah":108043551655436.4,"vef":275807430301.6452,"vnd":6.834123567491717e+16,"zar":51931569781848.09,"xdr":2080521246859.1675,"xag":110333136201.5312,"xau":1235197502.947833,"bits":39653853024848.305,"sats":3965385302484830.5},"total_volume":{"btc":1439503.3923421744,"eth":28667475.452169854,"ltc":943471213.9092317,"bch":166642963.93412292,"bnb":163961341.34878814,"eos":91744669543.45274,"xrp":160044243781.40533,"xlm":705243805625.3853,"link":5312530681.686844,"dot":10525001148.867905,"yfi":11143696.73326979,"usd":99992872812.4517,"aed":367263822552.8544,"ars":85700711114225.52,"aud":153332470928.28918,"bdt":10973957509718.645,"bhd":37697813014.658424,"bmd":99992872812.4517,"brl":501484255729.0074,"cad":135454945183.89644,"chf":90175372573.97963,"clp":97968017137999.61,"cny":722068533153.276,"czk":2338793397926.9927,"dkk":691087141412.557,"eur":92642596717.75406,"gbp":79227352915.48984,"gel":269980756593.61978,"hkd":782480227191.6473,"huf":36472672338955.82,"idr":1587323272229721.8,"ils":369007698254.70355,"inr":8333116040858.577,"jpy":15134753063878.947,"krw":134614794467281.73,"kwd":30805104305.950504,"lkr":30042079092064.723,"mmk":209977232262154.8,"mxn":1657111886109.7944,"myr":472416327602.4276,"ngn":139536054294863.95,"nok":1083574766089.5898,"nzd":167170284611.05887,"php":5616099401532.728,"pkr":27792355745495.63,"pln":397526665509.54193,"rub":9258599375224.115,"sar":375361045407.46094,"sek":1067750893967.0188,"sgd":134852388132.32861,"thb":3634740926732.621,"try":3241869029445.3696,"twd":3196771943828.3325,"uah":3922167639831.5806,"vef":10012286354.710796,"vnd":2480904958447619.5,"zar":1885205728275.1443,"xdr":75526516699.8283,"xag":4005283515.585001,"xau":44839803.955287665,"bits":1439503392342.1743,"sats":143950339234217.44},"market_cap_percentage":{"btc":49.598521958699976,"eth":15.20631175939618,"usdt":3.793312585962908,"bnb":3.4068915267289057,"sol":3.0013528877863744,"xrp":1.2450617546251863,"steth":1.2237361829036701,"usdc":1.1726081354682691,"doge":1.1140329212417404,"ada":0.8279520273173401},"market_cap_change_percentage_24h_usd":-0.9133013985239052,"updated_at":1711741211}}
 
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
}
